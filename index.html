<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chiyuen Chung — Film Photography</title>
  <meta name="description" content="Selections from my 35mm and medium-format cameras." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="icon" href="/favicon.ico">
  <meta property="og:title" content="Chiyuen Chung — Film Photography">
  <meta property="og:description" content="Selections from my 35mm and medium-format cameras.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://chiyuenchung.com/">
  <link rel="stylesheet" href="./css/styles.css?v=3">
</head>
<body>
  <header>
    <a class="brand" href="/"><h1>Chiyuen Chung — Film Photography</h1></a>
    <p>Selections from my 35mm and medium-format cameras</p>
  </header>

  <main class="grid" id="gallery" aria-live="polite"></main>

  <footer>
    <p>© 2025 Chiyuen Chung</p>
  </footer>

  <!-- gallery renderer -->
  <script>
    async function renderGallery() {
      const el = document.getElementById('gallery');
      try {
        const res = await fetch('/img/photos.json?v=' + Date.now());
        const photos = await res.json();

        // newest-first using precise timestamp if present, else date
        photos.sort((a, b) => {
          const A = a.ts || a.date || '';
          const B = b.ts || b.date || '';
          return new Date(B) - new Date(A);
        });

        const html = photos.map(p => {
          const base = p.base;
          const title = p.title || base;
          const alt = (p.alt || title || base).replace(/"/g, '&quot;');
          const dateISO = p.date || '';   // "YYYY-MM-DD"
          const dateBadge = dateISO ? `<time class="date-badge" datetime="${dateISO}">${dateISO}</time>` : '';

          return `
            <a class="card" href="/img/${base}-2560.jpg" aria-label="Open full-size image of ${alt}">
              <div class="square">
                <img
                  src="/img/${base}-640.jpg"
                  srcset="/img/${base}-640.jpg 640w,
                          /img/${base}-1280.jpg 1280w,
                          /img/${base}-2560.jpg 2560w"
                  sizes="(max-width: 900px) 90vw, 480px"
                  alt="${alt}" loading="lazy" />
                ${p.overlay ? `<div class="tile-overlay">${p.overlay}</div>` : ''}
              </div>
              <span class="caption">
                <span class="caption-title">${title}</span>
                ${dateBadge}
              </span>
            </a>
          `;
        }).join('');

        el.innerHTML = html || '<p class="center">No photos yet.</p>';
      } catch (e) {
        console.error('Failed to load photos.json', e);
        el.innerHTML = '<p class="center">Loading photos…</p>';
      }
    }
    renderGallery();
  </script>

  <!-- lightbox -->
  <script>
    document.addEventListener('click', e => {
      const a = e.target.closest('a.card');
      if (!a) return;
      e.preventDefault();

      const src = a.getAttribute('href');
      const overlay = document.createElement('div');
      overlay.setAttribute('role','dialog');
      overlay.setAttribute('aria-modal','true');
      overlay.tabIndex = -1;
      overlay.style = `
        position:fixed;inset:0;background:rgba(0,0,0,.92);
        display:flex;align-items:center;justify-content:center;z-index:9999;
      `;

      const closeBtn = document.createElement('div');
      closeBtn.className = 'lb-close';
      closeBtn.textContent = '×';

      const img = new Image();
      img.src = src;
      img.alt = '';
      img.style = 'max-width:95vw;max-height:95vh;cursor:zoom-out;';

      const close = () => {
        overlay.remove();
        document.removeEventListener('keydown', escHandler);
        document.body.style.overflow = '';
        a.focus();
      };
      const escHandler = ev => { if (ev.key === 'Escape') close(); };

      closeBtn.addEventListener('click', close);
      img.addEventListener('click', close);
      overlay.addEventListener('click', ev => { if (ev.target === overlay) close(); });
      document.addEventListener('keydown', escHandler);

      overlay.appendChild(closeBtn);
      overlay.appendChild(img);
      document.body.appendChild(overlay);
      document.body.style.overflow = 'hidden';
      overlay.focus();
    });
  </script>
</body>
</html>
